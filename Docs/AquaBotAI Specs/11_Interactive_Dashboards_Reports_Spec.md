# Interactive Dashboards & Reports — Feature Specification
**Aquatic AI | R-104, R-105 | P1 — Nice-to-Have (Fast Follow)**

## Problem Statement
Advanced hobbyists managing multiple tanks need two things their current tools don't provide: a way to passively stay informed without opening the app (email reports), and a way to compare performance across tanks to identify what's working and what isn't (multi-tank comparison). These features transform Aquatic AI from a single-tank tool into a command center for serious aquarists — and they provide compelling upgrade incentives for the Pro tier.

## Goals
- Deliver AI-generated daily or weekly tank health reports via email so users stay informed passively
- Provide side-by-side parameter comparison across tanks for multi-tank keepers
- Aggregate health view showing all tanks at a glance with color-coded status
- Both features are Pro tier ($14.99/mo) exclusives — key upgrade drivers
- Email reports achieve > 50% open rate (indicating genuine user value)

## Non-Goals
- NG1: Real-time streaming dashboards — data refreshes on page load or manual refresh
- NG2: PDF report generation or print-friendly formatting — P2 consideration
- NG3: Custom report builder (user picks which metrics/sections) — fixed report format in v1
- NG4: Sharing reports with other users or exporting — single-user only
- NG5: SMS or push notification reports — email only for delivered reports

## User Stories

### Email Reports (R-104)
- US-28: As a hobbyist, I want AI-generated daily tank reports delivered to my dashboard (and optionally via email), so I start each day knowing the state of my tanks.
- US-report1: As a busy hobbyist, I want to receive a weekly email summarizing all my tanks' health, parameter trends, upcoming maintenance, and AI recommendations, so I stay informed without opening the app.
- US-report2: As a multi-tank keeper, I want to configure which tanks are included in email reports and at what frequency (daily vs. weekly), so I get the right level of detail.

### Multi-Tank Comparison (R-105)
- US-29: As a multi-tank keeper, I want to compare parameters across tanks side-by-side, so I can spot differences and learn what's working best.
- US-compare1: As a hobbyist with freshwater and saltwater tanks, I want an aggregate dashboard showing all tanks with color-coded health status, so I can quickly see which tanks need attention.
- US-compare2: As an advanced keeper, I want to compare specific parameters (e.g., nitrate trends) across 2-3 tanks on the same chart, so I can identify environmental differences.

## Requirements

### Must-Have (P0 for this feature)

**R-104: Email Reports**
- **R-104.1: AI-generated tank health report** — Daily or weekly report content generated by Claude Sonnet 4.5. Includes: overall health score per tank, parameter summary with trend arrows, any alerts or warnings, upcoming maintenance tasks, AI recommendations.
  - Acceptance: Given a Pro user with daily reports enabled, they receive an email by 7:00 AM in their local timezone with a comprehensive report. Given the report includes parameter data, trends are shown with up/down arrows and color coding.

- **R-104.2: Email delivery** — Reports delivered via transactional email service. Clean, mobile-responsive HTML email template. Unsubscribe link in every email.
  - Acceptance: Given an email is sent, it renders correctly on Gmail, Apple Mail, and Outlook. Given a user clicks unsubscribe, email reports are disabled immediately.

- **R-104.3: User configuration** — Settings page where users configure: frequency (daily or weekly), which tanks to include, delivery time preference, enable/disable.
  - Acceptance: Given a user sets weekly reports for 2 of their 4 tanks, they receive one weekly email covering only those 2 tanks.

- **R-104.4: Pro tier gating** — Email reports are Pro tier only. Plus and Starter users see the feature in settings with an upgrade prompt.
  - Acceptance: Given a Plus user navigates to report settings, they see a preview of the feature with an upgrade CTA.

**R-105: Multi-Tank Comparison Dashboard**
- **R-105.1: Aggregate health view** — Single dashboard showing all tanks with: tank name, photo, overall health indicator (green/yellow/red), key parameter summary, next maintenance task due.
  - Acceptance: Given a user with 4 tanks, the dashboard shows all 4 with at-a-glance health status. Given one tank has a parameter in the danger zone, its indicator is red.

- **R-105.2: Side-by-side parameter comparison** — Select 2-3 tanks and compare a specific parameter over time on the same chart. Support all tracked parameters.
  - Acceptance: Given a user selects Tank A and Tank B and chooses "nitrate", they see both tanks' nitrate trends overlaid on a single chart with different colors. Given the charts, they can toggle between time ranges (7d, 30d, 90d).

- **R-105.3: Cross-tank insights** — AI analyzes differences between tanks and surfaces insights (e.g., "Tank B's nitrates are consistently lower — this may be due to its higher plant density").
  - Acceptance: Given a user views the comparison dashboard, they see at least one AI-generated insight about differences between their tanks.

- **R-105.4: Pro tier gating** — Multi-tank comparison is Pro tier only. Users on other tiers see the single-tank dashboard with an upgrade prompt for comparison features.
  - Acceptance: Given a Plus user with multiple tanks, they can see individual tank dashboards but not the comparison view.

### Nice-to-Have (P1)
- **R-104.5: In-app report view** — View the same report content in the app (not just email), with historical report archive.
- **R-105.5: Custom comparison groups** — Save comparison configurations (e.g., "all freshwater tanks" or "reef tanks") for quick access.
- **R-105.6: Leaderboard view** — Rank tanks by health score, maintenance consistency, or parameter stability.

### Future Considerations (P2)
- **R-104.6: PDF report export** — Generate downloadable PDF reports for record-keeping or sharing with fish stores/vets.
- **R-104.7: Scheduled report API** — API endpoint for third-party integrations to receive report data.
- **R-105.7: Community benchmarks** — Compare your tank's parameters against anonymized community averages for similar setups.

## Success Metrics
### Leading
- Email report opt-in: > 60% of Pro users enable email reports
- Email open rate: > 50% of delivered reports are opened
- Comparison dashboard usage: > 40% of Pro users with 2+ tanks use comparison at least monthly

### Lagging
- Pro upgrade attribution: Email reports + multi-tank comparison mentioned in > 20% of Plus-to-Pro upgrade reasons
- Retention impact: Pro users with email reports enabled show 15%+ lower churn than those without
- User satisfaction: > 4.2/5.0 rating on report usefulness

## Decisions (Resolved)
- ✅ Dashboard landing: Home tab shows a dashboard-first view with: health score card, recent parameter chart (sparkline), upcoming maintenance, livestock summary, and quick-action buttons. Per Figma wireframes.
- ✅ Report delivery: Email reports via Resend (Plus and Pro tiers). In-app report viewer for all tiers. PDF export deferred to P2.
- ✅ Chart library: Recharts (React-based, lightweight, good mobile support). Consistent with React ecosystem. Charts are responsive and touch-friendly.
- ✅ Report frequency: Daily AI summary (in-app, Plus+). Weekly email digest (Plus+). Monthly comprehensive report (Pro). All configurable in report preferences.
- ✅ Multi-tank comparison: Pro-only feature. Side-by-side parameter comparison with synchronized date range selector. Available in both dashboard and reports.
- ✅ Email service: Resend for all transactional and report emails. Branded templates with Aquatic AI styling.

## Timeline Considerations
- Phase 2 (Fast Follow): Ship after MVP P0 features, ideally within 4-6 weeks of launch
- R-104 (email reports) and R-105 (comparison) can be developed independently in parallel
- Dependency: Water Parameter Tracking (R-003/004/005) — reports and comparison need parameter data
- Dependency: AI Chat Engine (R-001) — for AI-generated report content and cross-tank insights
- Dependency: Tank Profile Management (R-002) — for multi-tank data
- Dependency: Subscription & Billing (R-010) — for Pro tier gating
- Email infrastructure setup (domain verification, sender reputation) is a pre-development task

## Technical Notes
- Email: Transactional email via Resend or SendGrid. HTML templates with MJML for responsive design.
- Report generation: Supabase Edge Function on cron schedule. Queries parameter data, passes to Claude Sonnet 4.5 for narrative generation, formats HTML email, sends via email API.
- Comparison charts: Recharts or Chart.js with multi-series support. Server-side rendering for email chart images.
- Health score: Calculated per tank based on: % of parameters within safe zone, maintenance consistency score, days since last parameter log.
- Data model: report_preferences table — id, user_id, frequency (daily/weekly), tanks (array of tank_ids), delivery_time, enabled, created_at. report_history table — id, user_id, generated_at, content (JSONB), email_sent.
- RLS: Reports and preferences scoped to authenticated user.
- Caching: Cache generated report content for in-app viewing (don't regenerate on page load).
